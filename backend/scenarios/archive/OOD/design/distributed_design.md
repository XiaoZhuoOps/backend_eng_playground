# 分布式系统设计模式

## Replication (冗余备份)

核心思想是“不要把鸡蛋放在一个篮子里”。通过部署多个服务或数据副本，当一个副本失效时，其他副本可以接管。

### Active-Passive (主备模式)

一个主节点处理所有请求，一个或多个备用节点待命。当主节点故障，备用节点会被提升为新的主节点。常用于数据库高可用方案。

### Active-Active (双活/多活模式)

所有节点都同时处理请求。通常需要一个负载均衡器在前端分发流量。单个节点故障只会影响一小部分流量，系统整体可用性极高。常用于无状态的 Web 服务器。

### Leader-Follower (领导者-跟随者模式)

介于前两者之间。一个 Leader 节点处理所有写请求，并将状态变更复制给多个 Follower 节点，Follower 节点可以处理读请求。当 Leader 故障时，会从 Follower 中选举出新的 Leader。这是 Raft 和 ZooKeeper 等系统的核心。

## Checkpointing & Recovery (检查点与恢复)

定期将系统的完整状态保存到持久化存储。当系统崩溃后，可以从最近的检查点恢复，而不是从头开始。这是 Fail-Stop 模式最常用的“后悔药”。

## Consensus (共识算法)

这是分布式系统领域的圣杯。它解决的核心问题是：如何让一组可能宕机的节点就一个值（或一系列值）达成完全一致的决定。Paxos 和 Raft 是最著名的共识算法，它们是构建强一致性系统（如分布式数据库 TiDB、etcd）的基石。

## Circuit Breaker (熔断器模式)

在微服务架构中，当一个服务（如服务 A）持续调用另一个失败的服务（服务 B）时，熔断器会像电路保险丝一样“跳闸”。它会暂时阻止 A 对 B 的所有后续调用，并立即返回一个错误，而不是让 A 的请求长时间等待超时。这可以防止故障在系统中级联（雪崩效应）。

## Bulkhead (舱壁隔离模式)

源自船体设计。将系统资源（如线程池、连接池）划分为多个隔离的“舱室”。如果某个功能或对某个外部服务的调用耗尽了其舱室内的资源，不会影响到其他舱室的功能。

## Idempotency (幂等性)

指一个操作执行一次和执行多次的效果是完全相同的。在分布式系统中，由于网络问题可能导致重试，保证操作的幂等性至关重要。例如，“将账户余额设置为 100 元”是幂等的，而“给账户余额增加 10 元”是非幂等的。
